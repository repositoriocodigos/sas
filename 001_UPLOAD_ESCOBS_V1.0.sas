%LET DAT_ARQUIVO = '02JUL2015'D;
%LET VAR_BILLING = '20150703';  
*%LET CAMINHO   = '\\BRSLP1W8PFS03\GRUPOS\AFINIDADE\PLANEJAMENTO_CREDITO_COBRANCA\008_M.I.S\03_BOOK_ESCOBS\TXT\REMESSA_BILLING\2015\07_JUL\B_UL20150713.TXT';
*%LET CAMINHO = '\\BRSLP1W8PFS03\GRUPOS\AFINIDADE\PLANEJAMENTO_CREDITO_COBRANCA\008_M.I.S\03_BOOK_ESCOBS\TXT\REMESSA_RETIRADA\2015\07_JUL\R_UL20150701.TXT';
*%LET CAMINHO = '\\BRSLP1W8PFS03\GRUPOS\AFINIDADE\PLANEJAMENTO_CREDITO_COBRANCA\008_M.I.S\03_BOOK_ESCOBS\TXT\REMESSA_COMPLEMENTAR\2015\07_JUL\C_UL20150702.TXT';
*%LET CAMINHO = '\\BRSLP1W8PFS03\GRUPOS\AFINIDADE\PLANEJAMENTO_CREDITO_COBRANCA\008_M.I.S\03_BOOK_ESCOBS\TXT\REMESSA_UI\2015\07_JUL\UI_AS20150710.TXT';
%LET CAMINHO = '\\BRRVA1W7448684\AGENCIAS\CMD\REMESSA\II\C_AL20150701.TXT';
*%LET CAMINHO = '\\BRRVA1W7448684\AGENCIAS\BAIXA\BAIXA.TXT';

%LET BASE         = PADRAO;
%LET ESCOB1     = "ALMAVIVA           "; /* A1SOLUCOES EMPRESARIO INOVE ULTRACENTER FATTOR ALMAVIVA ZANC TALENTO CSU */  
%LET FASE         = "FASE_2  " 		   ;/* FASE_1 FASE_2 FASE_3 */ 
%LET BASE_DESC     = 'REMESSA COMP                 '; /* BAIXA REMESSA REMESSA COMP REMESSA UI */
%LET ANOMES        = 201507;                                                                                                                                 
DATA &BASE; /*IMPORTACAO DA ARQUIVO TXT*/
INFILE &CAMINHO
LRECL=1122
ENCODING="WLATIN1"
TRUNCOVER;

LENGTH
LINHA_C $ 1 CLIENTE $ 20 FILLER $ 2 C_TIPO $ 2 NUMERO_T $ 18	C_FILIAL $ 5 C_TOTPAR $ 2 C_PARCI $ 2 C_PARCF $ 2 VENC_TITULO $ 8 VALOR $ 12 C_VTPAR $ 12 C_OPERESP $ 3 C_OBSE $ 60
KEY_ID $ 16 C_DATRET $ 8 EMISSAO_T $ 8 STATUS_ENVIO $ 4 FILLER2 $ 378 C_CREDOR $ 5 C_DT_DESATIV $ 8 C_DT_SUSPENSAO $ 8 C_NEGATIVADO $ 1 C_DT_NEGATIVACAO $ 8 C_CUSTO $ 50
C_SOCIO1 $ 20 C_PER_SOCIO1 $ 3 C_SOCIO2 $ 20 C_PER_SOCIO2 $ 3 C_SOCIO3 $ 20 C_PER_SOCIO3 $ 3 C_RENDA $ 15 C_CAP_SOCIAL $ 15 C_DT_FUND $ 8 C_CONTATO_1 $ 30 C_FONE_1_1 $ 15
C_FONE_2_1 $ 15 C_FONE_3_1 $ 15 C_CONTATO_2 $ 30 C_FONE_1_2 $ 15 C_FONE_2_2 $ 15 C_FONE_3_2 $ 15 C_CONTATO_3 $ 30 C_FONE_1_3 $ 15 C_FONE_2_3 $ 15 C_FONE_3_3 $ 15 C_CONTATO_1_1 $ 30
C_FONE_NEXTEL_1 $ 15 C_CONTATO_2_2 $ 30 C_FONE_NEXTEL_2 $ 15 C_CONTATO_3_3 $ 30 C_FONE_NEXTEL_3 $ 15 AGING $ 5 TIPO_BAIXA $ 5 FILLER3 $ 2;
DROP
FILLER C_TIPO C_FILIAL C_TOTPAR C_PARCI C_PARCF C_VTPAR C_OPERESP C_OBSE C_DATRET FILLER2 C_CREDOR C_DT_DESATIV C_DT_SUSPENSAO C_NEGATIVADO C_DT_NEGATIVACAO C_SOCIO1 C_PER_SOCIO1
C_SOCIO2 C_PER_SOCIO2 C_SOCIO3 C_PER_SOCIO3 C_RENDA C_CAP_SOCIAL C_DT_FUND C_CONTATO_1 C_FONE_1_1 C_FONE_2_1 C_FONE_3_1 C_CONTATO_2 C_FONE_1_2 C_FONE_2_2 C_FONE_3_2 C_CONTATO_3
C_FONE_1_3 C_FONE_2_3 C_FONE_3_3 C_CONTATO_1_1 C_FONE_NEXTEL_1 C_CONTATO_2_2 C_FONE_NEXTEL_2 C_CONTATO_3_3 C_FONE_NEXTEL_3 FILLER3;
FORMAT
LINHA_C CHAR1. CLIENTE CHAR20. FILLER CHAR2. C_TIPO CHAR2. NUMERO_T CHAR18. C_FILIAL CHAR5. C_TOTPAR CHAR2. C_PARCI CHAR2. C_PARCF CHAR2. VENC_TITULO CHAR8. VALOR CHAR12. C_VTPAR CHAR12. 
C_OPERESP CHAR3. C_OBSE CHAR60. KEY_ID CHAR16. C_DATRET CHAR8. EMISSAO_T CHAR8. STATUS_ENVIO CHAR4. FILLER2 CHAR378. C_CREDOR CHAR5. C_DT_DESATIV CHAR8. C_DT_SUSPENSAO CHAR8. C_NEGATIVADO CHAR1.
C_DT_NEGATIVACAO CHAR8. C_CUSTO CHAR50. C_SOCIO1 CHAR20. C_PER_SOCIO1 CHAR3. C_SOCIO2 CHAR20. C_PER_SOCIO2 CHAR3. C_SOCIO3 CHAR20. C_PER_SOCIO3 CHAR3. C_RENDA CHAR15. C_CAP_SOCIAL CHAR15.
C_DT_FUND CHAR8. C_CONTATO_1 CHAR30. C_FONE_1_1 CHAR15. C_FONE_2_1 CHAR15. C_FONE_3_1 CHAR15. C_CONTATO_2 CHAR30. C_FONE_1_2 CHAR15. C_FONE_2_2 CHAR15. C_FONE_3_2 CHAR15. C_CONTATO_3 CHAR30.
C_FONE_1_3 CHAR15. C_FONE_2_3 CHAR15. C_FONE_3_3 CHAR15. C_CONTATO_1_1 CHAR30. C_FONE_NEXTEL_1 CHAR15. C_CONTATO_2_2 CHAR30. C_FONE_NEXTEL_2 CHAR15. C_CONTATO_3_3 CHAR30. C_FONE_NEXTEL_3 CHAR15.
AGING CHAR5. TIPO_BAIXA CHAR5. FILLER3 CHAR2.;
INFORMAT
LINHA_C $CHAR1.CLIENTE $CHAR20. FILLER $CHAR2. C_TIPO $CHAR2. NUMERO_T $CHAR18. C_FILIAL $CHAR5. C_TOTPAR $CHAR2. C_PARCI $CHAR2. C_PARCF $CHAR2. VENC_TITULO $CHAR8. VALOR $CHAR12.
C_VTPAR $CHAR12. C_OPERESP $CHAR3. C_OBSE $CHAR60. KEY_ID $CHAR16. C_DATRET $CHAR8. EMISSAO_T $CHAR8. STATUS_ENVIO $CHAR4. FILLER2 $CHAR378. C_CREDOR $CHAR5. C_DT_DESATIV $CHAR8.
C_DT_SUSPENSAO $CHAR8. C_NEGATIVADO $CHAR1. C_DT_NEGATIVACAO $CHAR8. C_CUSTO $CHAR50. C_SOCIO1 $CHAR20. C_PER_SOCIO1 $CHAR3. C_SOCIO2 $CHAR20.C_PER_SOCIO2 $CHAR3.C_SOCIO3 $CHAR20.
C_PER_SOCIO3 $CHAR3. C_RENDA $CHAR15. C_CAP_SOCIAL $CHAR15. C_DT_FUND $CHAR8. C_CONTATO_1 $CHAR30. C_FONE_1_1 $CHAR15. C_FONE_2_1 $CHAR15. C_FONE_3_1 $CHAR15. C_CONTATO_2 $CHAR30.
C_FONE_1_2 $CHAR15. C_FONE_2_2 $CHAR15. C_FONE_3_2 $CHAR15. C_CONTATO_3 $CHAR30. C_FONE_1_3 $CHAR15. C_FONE_2_3 $CHAR15. C_FONE_3_3 $CHAR15. C_CONTATO_1_1 $CHAR30. C_FONE_NEXTEL_1 $CHAR15.
C_CONTATO_2_2 $CHAR30. C_FONE_NEXTEL_2 $CHAR15. C_CONTATO_3_3 $CHAR30. C_FONE_NEXTEL_3 $CHAR15. AGING $CHAR5. TIPO_BAIXA $CHAR5. FILLER3 $CHAR2.;
INPUT
@1 LINHA_C $CHAR1. @2 CLIENTE $CHAR20. @22 FILLER $CHAR2. @24 C_TIPO $CHAR2. @26 NUMERO_T $CHAR18. @44 C_FILIAL $CHAR5. @49 C_TOTPAR $CHAR2. @51 C_PARCI $CHAR2. @53 C_PARCF $CHAR2.
@55 VENC_TITULO $CHAR8. @63 VALOR $CHAR12. @75 C_VTPAR $CHAR12. @87 C_OPERESP $CHAR3. @90 C_OBSE $CHAR60. @150 KEY_ID $CHAR16. @166 C_DATRET $CHAR8. @174 EMISSAO_T $CHAR8. @182 STATUS_ENVIO $CHAR4.
@186 FILLER2 $CHAR378. @564 C_CREDOR $CHAR5.@569 C_DT_DESATIV $CHAR8.@577 C_DT_SUSPENSAO $CHAR8.@585 C_NEGATIVADO $CHAR1.@586 C_DT_NEGATIVACAO $CHAR8.@594 C_CUSTO $CHAR50.
@644 C_SOCIO1 $CHAR20.@664 C_PER_SOCIO1 $CHAR3.@667 C_SOCIO2 $CHAR20.@687 C_PER_SOCIO2 $CHAR3.@690 C_SOCIO3 $CHAR20.@710 C_PER_SOCIO3 $CHAR3.@713 C_RENDA $CHAR15.@728 C_CAP_SOCIAL $CHAR15.
@743 C_DT_FUND $CHAR8.@751 C_CONTATO_1 $CHAR30.@781 C_FONE_1_1 $CHAR15.@796 C_FONE_2_1 $CHAR15.@811 C_FONE_3_1 $CHAR15.@826 C_CONTATO_2 $CHAR30.@856 C_FONE_1_2 $CHAR15.@871 C_FONE_2_2 $CHAR15.
@886 C_FONE_3_2 $CHAR15.@901 C_CONTATO_3 $CHAR30.@931 C_FONE_1_3 $CHAR15.@946 C_FONE_2_3 $CHAR15.@961 C_FONE_3_3 $CHAR15.@976 C_CONTATO_1_1 $CHAR30.@1006 C_FONE_NEXTEL_1 $CHAR15.
@1021 C_CONTATO_2_2 $CHAR30.@1051 C_FONE_NEXTEL_2 $CHAR15.@1066 C_CONTATO_3_3 $CHAR30.@1096 C_FONE_NEXTEL_3 $CHAR15.@1111 AGING $CHAR5.@1116 TIPO_BAIXA $CHAR5.@1121 FILLER3 $CHAR2.;
RUN;
DATA BDESCOB(COMPRESS=YES REUSE= YES);
    SET &BASE;
    C_CUSTO = COMPRESS(TRANWRD(C_CUSTO,'.00.100000',''));
    ATRASO = AGING*1.;
    LENGTH ESCOB $50.;
    VALOR_TITULO = VALOR*1;
    FORMAT VALOR_TITULO COMMAX9.2;
	CLIENTE = IDCLIENTE *1;
	ESPECIE = SUBSTR(NUMERO_T,7,2);
    PTITULO = SUBSTR(NUMERO_T,9,10);
    TITULO = PTITULO *1;
    ESCOB = &ESCOB1;
    BASE = &BASE_DESC;
	FASE = &FASE;
	DROP 
	PTITULO
	AGING
	VALOR	
	;

    IF ESCOB = "A1SOLUCOES  " THEN
        P_COBR = "00035";
    ELSE IF  ESCOB = "ULTRACENTER" THEN
        P_COBR = "00032";
    ELSE IF ESCOB = "EMPRESARIO" THEN
        P_COBR = "00031";
    ELSE  IF ESCOB = "INOVE" THEN
        P_COBR = "00041";
    ELSE  IF ESCOB = "FATTOR" THEN
        P_COBR = "00042";
    ELSE  IF ESCOB = "UTRACENTER" THEN
        P_COBR = "00043";
    ELSE  IF ESCOB = "ZANC" THEN
        P_COBR = "00006";
	ELSE  IF ESCOB = "ALMAVIVA" THEN
        P_COBR = "00044";
	ELSE  IF ESCOB = "TALENTO" THEN
        P_COBR = "00045";
	ELSE  IF ESCOB = "BELINATI" THEN
        P_COBR = "00046";

    IF STATUS_ENVIO = "ENV" THEN
        STATUS = "REMESSA    ";
    ELSE IF STATUS_ENVIO = "BXA" AND TIPO_BAIXA = "DP" THEN
        STATUS = "DECURSO";
    ELSE IF STATUS_ENVIO = "BXA" AND TIPO_BAIXA = "PG" THEN
        STATUS = "PAGAMENTO";
    ELSE IF STATUS_ENVIO = "BXA" AND TIPO_BAIXA = "OT" THEN
        STATUS = "OUTROS";
    ELSE STATUS = "XXX";


    IF LENGTH(IDCLIENTE) = 14 THEN
        TIPO = "PJ";
    ELSE TIPO = "PF";
    WHERE LINHA_C = 'C';

    IF ESPECIE = "BE  " THEN
        TECNOLOGIA = "3G  ";
    ELSE IF ESPECIE = "BD  " THEN
        TECNOLOGIA = "2G  ";
    ELSE TECNOLOGIA = "OT";

RUN;
/*PROC APPEND 
    DATA=WORK.BDESCOB
    BASE=ESCOBS.BDESCOB_&ANOMES
    FORCE;
RUN;
PROC SQL;
	CREATE TABLE X AS
		SELECT   
			BASE,   
			DATA_ARQUIVO, 
			ESCOB,
			FASE, 
			SUM(VALOR) AS VALOR FORMAT COMMAX9.2,
			COUNT(VALOR)AS QUANT_TITULO
		FROM ESCOBS.BDESCOB_&ANOMES
			GROUP BY 
				BASE,   
				DATA_ARQUIVO,
				FASE, 
				ESCOB;
RUN;
/*PROC SQL;
   DELETE FROM ESCOBS.BDESCOB_&ANOMES
       WHERE DATA_ARQUIVO = '02JUL2015'D 
         AND ESCOB = ('ZANC')
		  AND FASE = "FASE_2"
           AND BASE IN ('REMESSA COMP');
RUN;

/*DATA ESCOBS.BDESCOB_&ANOMES;
SET WORK.BDESCOB;RUN;*/












