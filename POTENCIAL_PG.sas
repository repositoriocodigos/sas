/* NO INICIO DE CADA MÊS IMPORTAR O ARQUIVO RECEBIDO PELA FLÁVIA RESPONSÁVEL POR VMT E ALTERAR OS MESES DE REFERÊNCIAS NO CÓDIGO */
/* VERIFICAR NA LIBRARY A TABELA DO ULTIMO DIA DISPONIVEL E ALTERAR AS DATAS DE REFERENCIA */
/*SITUAÇÃO CONTÁBIL NO SYSIN*/

PROC SQL;/*POTENCIAL WO*/
 CREATE TABLE WORK.POTENCIAL_WO_012012 AS 
 SELECT DRI_899_PARCELA_CFI_20120125.CONTRATO FORMAT=$12.,
 NUM_PARC,
 DTA_VCTO_PARC,
 DATA_PAGTO,
 VLR_PAGO,
 TIPO_LIQUIDACAO
 FROM BRCFDBCO.DRI_899_PARCELA_CFI_20120125 AS PARCELA_CFI_20120125
 WHERE DATA_PAGTO BETWEEN '01jan2012:00:00:00'D AND '31jan2012:00:00:00'D;
 RUN;
PROC SQL;/*PAGAMENTOS IDENTIFICADOS*/
 CREATE TABLE WORK.PAGAMENTOS_IDENTIFICADOS AS SELECT DISTINCT 
     POTENCIAL_WO_012012.CONTRATO FORMAT=$12.,
	 POTENCIAL_WO_012012.DTA_VCTO_PARC FORMAT=DATETIME20.,
	 POTENCIAL_WO_012012.DATA_PAGTO FORMAT=DATETIME20.,
	 POTENCIAL_WO_012012.VLR_PAGO FORMAT=12.2,
	 POTENCIAL_WO_012012.TIPO_LIQUIDACAO FORMAT=$1.
 FROM WORK.POTENCIAL_WO_012012 AS POTENCIAL_WO_012012 
	  INNER JOIN WORK.BASE_POTENCIAL_012012 AS BASE_POTENCIAL_012012 ON (POTENCIAL_WO_012012.CONTRATO = BASE_POTENCIAL_012012.CONTRATO)
 WHERE POTENCIAL_WO_012012.VLR_PAGO > 0;
QUIT;
PROC SQL;/*PAGAMENTOS DEVOLVIDOS*/
 CREATE TABLE WORK.PAGAMENTOS_DEVOLVIDOS AS SELECT DISTINCT 
     POTENCIAL_WO_012012.CONTRATO FORMAT=$12.,
	 POTENCIAL_WO_012012.DTA_VCTO_PARC FORMAT=DATETIME20.,
	 POTENCIAL_WO_012012.DATA_PAGTO FORMAT=DATETIME20.,
	 POTENCIAL_WO_012012.VLR_PAGO FORMAT=12.2,
	 POTENCIAL_WO_012012.TIPO_LIQUIDACAO FORMAT=$1.
 FROM WORK.POTENCIAL_WO_012012 AS POTENCIAL_WO_012012 
	  INNER JOIN WORK.BASE_POTENCIAL_012012 AS BASE_POTENCIAL_012012 ON (POTENCIAL_WO_012012.CONTRATO = BASE_POTENCIAL_012012.CONTRATO)
 WHERE POTENCIAL_WO_012012.VLR_PAGO = 0;
QUIT;
PROC SQL;/*SEM PAGAMENTOS*/
 CREATE TABLE WORK.SEM_PAGAMENTOS AS SELECT DISTINCT 
     BASE_POTENCIAL_012012.CONTRATO,
	 BASE_POTENCIAL_012012.SALDO_NACC,
	 BASE_POTENCIAL_012012.POTENCIAL
 FROM WORK.BASE_POTENCIAL_012012 AS BASE_POTENCIAL_012012 
	  LEFT JOIN WORK.POTENCIAL_WO_012012 AS POTENCIAL_WO_012012 ON (BASE_POTENCIAL_012012.CONTRATO = POTENCIAL_WO_012012.CONTRATO)
 WHERE POTENCIAL_WO_012012.CONTRATO IS NOT NULL;
 QUIT;
PROC SQL;/*RESULTADO - PAGAMENTOS*/
 CREATE TABLE WORK.RESULT AS SELECT PAGAMENTOS_IDENTIFICADOS.CONTRATO FORMAT=$12.,
	 PAGAMENTOS_IDENTIFICADOS.DTA_VCTO_PARC FORMAT=DATETIME20. AS VENC_PARC,
	 PAGAMENTOS_IDENTIFICADOS.DATA_PAGTO FORMAT=DATETIME20. AS DATE_PG,
	 PAGAMENTOS_IDENTIFICADOS.VLR_PAGO FORMAT=DOLLAR12.2,
	 BASE_POTENCIAL_012012.SALDO_NACC FORMAT=DOLLAR12.2 AS RISCO,
	 DRI_899_CONTRATO_CFI_20120125.SIT_CONT_NY FORMAT=$1. AS SIT_CONTABIL 
 FROM WORK.PAGAMENTOS_IDENTIFICADOS AS PAGAMENTOS_IDENTIFICADOS 
	  INNER JOIN WORK.BASE_POTENCIAL_012012 AS BASE_POTENCIAL_012012 ON (PAGAMENTOS_IDENTIFICADOS.CONTRATO = BASE_POTENCIAL_012012.CONTRATO) 
	  INNER JOIN BRCFDBCO.DRI_899_CONTRATO_CFI_20120125 AS DRI_899_CONTRATO_CFI_20120125
  ON (PAGAMENTOS_IDENTIFICADOS.CONTRATO = DRI_899_CONTRATO_CFI_20120125.CONTRATO)
 ORDER BY BASE_POTENCIAL_012012.SALDO_NACC, PAGAMENTOS_IDENTIFICADOS.DATA_PAGTO;
QUIT;







