%LET TEC_3GT_INICIAL ='09OCT2014'D;
%LET TEC_3GT_FINAL =  '30MAR2015'D;

PROC SQL;
    *2.SALDO PRECHURN;
    CREATE TABLE REPORT.STATUS3G_MAR AS
        SELECT

            INPUT(CUSTOMER_TAX_NUMBER,BEST14.) AS IDCLIENTE,
            INPUT(CONTRACT,8.) AS IDCONTRACT,
            DTSUSPENSION,
            TECHNOLOGY_TYPE,('3G|TOTAL') AS TIPO   
        FROM ESCOBS.SUSP_DETAILS_201503
            WHERE TECHNOLOGY_TYPE = '3G' AND  DTSUSPENSION BETWEEN &TEC_3GT_INICIAL AND &TEC_3GT_FINAL
                AND CONTRACT_REASON_STATUS = '230';
RUN;  
PROC SQL;
    *4.SALDO RECUPERADO CRUZANDO COM O REATIVADO;
    CREATE TABLE REPORT.M1_TB0 AS
        SELECT DISTINCT
            A.*,
            A.DT_REAT,
            B.DTSUSPENSION AS DTSUSPENSION  FORMAT  DDMMYY10.

        FROM REPORT.M1_TB02 AS A 
            LEFT JOIN REPORT.STATUS3G_MAR  AS B ON A.IDCLIENTE = B.IDCLIENTE AND A.IDCONTRACT = B.IDCONTRACT 
            WHERE (1=1)
                AND B.DTSUSPENSION IS   NULL;
RUN;

PROC SORT /*4.1 - ORDEM A BASE*/

    DATA  = REPORT.M1_TB0;
    BY IDCONTRACT IDCONTRACT 
        DESCENDING DTSUSPENSION;
RUN;

PROC SORT /*4.2 - RETIRANDO A DUPLICIDADE DE REATIVACAO DO SALDO RECUPERADO*/

    DATA  = REPORT.M1_TB0
        NODUPKEY;
    BY IDCONTRACT IDCONTRACT;
RUN;